kubectl.exe apply -n istio-system -f authorization-policy.yaml

$INVALID_TOKEN="eyJhbGciOiJSUzI1NiIsImtpZCI6IkRIRmJwb0lVcXJZOHQyenBBMnFYZkNtcjVWTzVaRXI0UnpIVV8tZW52dlEiLCJ0eXAiOiJKV1QifQ.eyJhdWQiOiJib3V0aXF1ZXN0b3JlLmNvbSIsImV4cCI6MTkxNDM2NTI1MSwiaWF0IjoxNTk5MDA1MjUxLCJpc3MiOiJ3cm9uZy1pc3N1c2VyQHNlY3VyZS5pc3Rpby5pbyIsInN1YiI6InVzZXIxQHh5ei5jb20ifQ.SnQPGlkV66Q61zR8uZAzEhyPfynNmV_MGzvjnkxZhVv-elrKu7Wq50tj4SKGyjTJPR2-YFd_-p3eN4VveCH5NB3LjgyOliMQjnxSTN92CHXjoy6kHol2Lo-kFJmoNBvNBkKFpFJ3oD6ejTse7718r7WSUzeh4R_vV9QNEHNPucxpL3Yhm_EuYIMV-cfA_N58dA1YAjcZtlEM8PsFwDQGv5vTndGkQ_co0acuDBgXZsJ6xCaNvpgrx_ftpzlaA27PknKK6rrvTRSuxKP4Jn3GIB0nBa6uXUfMvlkUBvepwXooXO5XAlWRTa3J6ys2KkOVkDKMN-jdSv-K3_rLXxxb3Q"
$VALID_TOKEN="eyJhbGciOiJSUzI1NiIsImtpZCI6IkRIRmJwb0lVcXJZOHQyenBBMnFYZkNtcjVWTzVaRXI0UnpIVV8tZW52dlEiLCJ0eXAiOiJKV1QifQ.eyJhdWQiOiJib3V0aXF1ZXN0b3JlLmNvbSIsImV4cCI6MTkxNDM2NTM2NSwiaWF0IjoxNTk5MDA1MzY1LCJpc3MiOiJ0ZXN0aW5nQHNlY3VyZS5pc3Rpby5pbyIsInN1YiI6InVzZXIxQHh5ei5jb20ifQ.pZHGJgEP0qsJ1pSBPU6nwpMETf3MqlWx-T0PED0BLb5aTnbXWklIzHV4JHgMk6Td4thI4cC4_mCvrFlgm1uqzO2U_DEdNOReNMGNnDSQ87hWEtOQxn50c83dVq3-w4FUrKBjS1lYhiabKWVfr3BC_Bmwefl1TVhgP_iNuQGsWsj_Tcl4TWP93yS93DazphAl0uIOw3WvmJSfhnaZ7cEIk0PzGmsLq96FLbGatZX1DL8OKhv2Hz-iN0V6KG_5GjjEdD7LVSprw4oedtwbahDVVuxh0due1DImXLhH9oH1_RkntrD98JlKYoNzG1-7apSV0xw5mlE8L2HXDo3TKE33WA"
$WRONG_AUDIENCE_TOKEN="eyJhbGciOiJSUzI1NiIsImtpZCI6IkRIRmJwb0lVcXJZOHQyenBBMnFYZkNtcjVWTzVaRXI0UnpIVV8tZW52dlEiLCJ0eXAiOiJKV1QifQ.eyJhdWQiOiJ3cm9uZy1hdWRpZW5jZS5jb20iLCJleHAiOjE5MTUyNTc5NzksImlhdCI6MTU5OTY4ODQ1OSwiaXNzIjoidGVzdGluZ0BzZWN1cmUuaXN0aW8uaW8iLCJzdWIiOiJ0ZXN0aW5nQHNlY3VyZS5pc3Rpby5pbyJ9.ELpcxqd9T6ZmdQ6Ilak26yiizi205az0hSmNnVALV_pCfbM2frMaNnESotFILe77Z3u-HeiVTomrgf-onAUW0bZJ3HWi_iPJZHQ5bq2-rvf5_E4IAr_p39argaVriCVRiPnBtuwzzptWOpS-wBe5uDr3V6otX7PcAH9s1FCCMnTxiEJzn_taTYLtpctoHDsNfw5RfDvVZbsuyEX1Ea0UUx1-VZrVV7n5_jXmo8yoHQ5DH6QDgpGJlYMebgLgoG7pL8N2oz7VLQQSO0x-rIdv_Icdee04fnrOzs01YdGWqfEfDjGbAjrqsq0e1HXhHF0AJNcsuNcFcQQv4nePyuKVyg"

curl.exe -v -H "Host: marketplace.boutiquestore.com" -H "Authorization: Bearer $VALID_TOKEN" http://127.0.0.1:50465/_healthz
curl.exe -v -H "Host: marketplace.boutiquestore.com" -H "Authorization: Bearer $INVALID_TOKEN" http://127.0.0.1:50465/_healthz

kubectl.exe apply -n istio-system -f authorization-policy-2.yaml

curl.exe -v -H "Host: marketplace.boutiquestore.com" -H "Authorization: Bearer $WRONG_AUDIENCE_TOKEN" http://127.0.0.1:50465/_healthz

kubectl.exe apply -n istio-system -f authorization-policy-3.yaml

curl.exe -v -H "Host: marketplace.boutiquestore.com" http://127.0.0.1:50465/_healthz
